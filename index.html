<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>홈페이지</title>
    <style>
      html, body { height: 100%; margin: 0; }
      body {
        background: #000 url('bg.jpg') center / cover no-repeat fixed;
        display: flex; justify-content: center; align-items: center;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, sans-serif;
      }

      /* 우상단 즐겨찾기 버튼(전 화면 공통) */
      .fav-list-btn { position: fixed; top: 16px; right: 16px; z-index: 20; border: 0; border-radius: 9999px; background: rgba(255,255,255,0.9); box-shadow: 0 2px 8px rgba(0,0,0,0.2); padding: 8px 12px; cursor: pointer; font-weight: 700; }

      #app { width: 100%; display: flex; justify-content: center; align-items: center; }

      /* 검색 화면 */
      .search-box { display: flex; width: 560px; height: 56px; border: 2px solid rgba(255,255,255,0.6); border-radius: 14px; overflow: hidden; backdrop-filter: blur(2px); }
      .search-box input { flex: 1; border: none; padding: 0 16px; font-size: 16px; background: rgba(255,255,255,0.95); outline: none; }
      .search-box input::placeholder { color: #777; }
      .search-box button { width: 68px; border: none; background: rgba(0,0,0,0.85); display: flex; justify-content: center; align-items: center; cursor: pointer; }
      .search-box button svg { width: 22px; height: 22px; fill: #ffffff; }

      /* 결과 패널 */
      .result-panel { width: min(80vw, 1200px); height: min(70vh, 800px); background: rgba(255,255,255,0.95); border: 2px solid rgba(255,255,255,1); border-radius: 24px; backdrop-filter: blur(2px); box-shadow: 0 10px 30px rgba(0,0,0,0.25); display: flex; flex-direction: column; position: relative; overflow: hidden; }
      .corner-btn { position: absolute; top: 12px; width: 36px; height: 36px; border: none; border-radius: 50%; background: rgba(0,0,0,0.8); color: #fff; font-size: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; z-index: 1000; }
      .back-btn { left: 12px; }
      .close-btn { right: 12px; }

      .menu { display: flex; justify-content: center; align-items: center; gap: 40px; flex: 1; }
      .menu-item { font-size: 24px; font-weight: 600; color: #222; padding: 12px 24px; border-radius: 12px; background: rgba(0,0,0,0.05); cursor: pointer; transition: background 0.2s; }
      .menu-item:hover { background: rgba(0,0,0,0.15); }

      .submenu { display: flex; justify-content: center; align-items: center; gap: 24px; flex: 1; flex-wrap: wrap; padding: 24px; }
      .submenu-item { font-size: 20px; font-weight: 500; color: #222; padding: 10px 20px; border-radius: 10px; background: rgba(0,0,0,0.05); cursor: pointer; transition: background 0.2s; }
      .submenu-item:hover { background: rgba(0,0,0,0.15); }

      .result-body { flex: 1; display: flex; }
      .list-panel { flex: 1; padding: 20px; border-right: 1px solid rgba(0,0,0,0.1); overflow-y: auto; }
      .list-title { font-size: 18px; font-weight: 700; color: #222; text-align: center; margin: 20px 0; }
      .list-item { background: rgba(0,0,0,0.05); border-radius: 12px; padding: 14px 16px; color: #222; font-weight: 500; margin-bottom: 10px; cursor: pointer; }
      .list-item:hover { background: rgba(0,0,0,0.15); }

      .detail-panel { flex: 2; padding: 20px; overflow-y: auto; position: relative; }
      .detail-panel img { max-width: 100%; border-radius: 8px; margin: 10px 0; }
      .favorite-btn { position: absolute; bottom: 20px; right: 20px; font-size: 28px; cursor: pointer; color: gray; }
      .favorite-btn.active { color: gold; }

      .tags { margin-top: 10px; }
      .tag { display: inline-block; background: #eee; border-radius: 8px; padding: 4px 8px; margin-right: 6px; font-size: 14px; }

      /* 즐겨찾기 맵 */
      .fav-map { position: relative; width: 100%; aspect-ratio: 16 / 9; max-height: 60vh; border-radius: 12px; background: repeating-linear-gradient(0deg, #f4f4f4, #f4f4f4 20px, #f0f0f0 20px, #f0f0f0 40px), repeating-linear-gradient(90deg, #f4f4f4, #f4f4f4 20px, #f0f0f0 20px, #f0f0f0 40px); border: 1px solid rgba(0,0,0,0.1); margin-bottom: 12px; z-index: 1; }
      .marker { position: absolute; width: 12px; height: 12px; border-radius: 50%; background: #e74c3c; border: 2px solid #fff; transform: translate(-50%, -50%); cursor: pointer; }
      .marker::after { content: attr(data-label); position: absolute; top: -28px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.75); color: #fff; font-size: 12px; padding: 2px 6px; border-radius: 6px; white-space: nowrap; opacity: 0; pointer-events: none; transition: opacity 0.15s; }
      .marker:hover::after { opacity: 1; }
      .fav-detail { padding-top: 6px; }

      @media (max-width: 800px) {
        .result-body { flex-direction: column; }
        .list-panel { border-right: none; border-bottom: 1px solid rgba(0,0,0,0.1); }
        .favorite-btn { bottom: 10px; right: 10px; }
        .fav-map { height: 40%; }
      }
    </style>
  </head>
  <body>
    <button class="fav-list-btn" id="openFavs">★ 즐겨찾기</button>
    <div id="app">
      <form id="searchForm" class="search-box" role="search" aria-label="지역 검색">
        <input id="q" type="text" placeholder="원하는 데이트 코스를 입력하세요" required />
        <button type="submit" aria-label="검색">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" role="img"><path d="M15.5 14h-.79l-.28-.27a6.471 6.471 0 001.48-5.34C15.23 5.01 12.22 2 8.62 2S2 5.01 2 8.62c0 3.6 3.01 6.61 6.62 6.61 1.61 0 3.09-.59 4.23-1.57l.27.28v.79l4.25 4.25c.41.41 1.08.41 1.49 0 .41-.41.41-1.08 0-1.49L15.5 14zM8.62 13c-2.41 0-4.38-1.97-4.38-4.38 0-2.41 1.97-4.38 4.38-4.38 2.41 0 4.38 1.97 4.38 4.38 0 2.41-1.97 4.38-4.38 4.38z"/></svg>
        </button>
      </form>
    </div>

    <script>
      const app = document.getElementById('app');
      const form = document.getElementById('searchForm');
      const input = document.getElementById('q');
      const openFavsBtn = document.getElementById('openFavs');

      const state = { location: '', category: '', type: '', favorites: loadFavorites() };

      // 전역: 모든 X 버튼은 무조건 홈으로
      document.addEventListener('click', (e)=>{
        if(e.target.closest('.close-btn')){ goHome(); }
      }, true);

      // 공통: 히스토리 상태 전환
      function pushView(view, extra={}){
        const st = { view, ...extra };
        history.pushState(st, '', `#${view}`);
      }

      // 초기 상태 등록
      history.replaceState({view:'search'}, '', '#search');

      openFavsBtn.addEventListener('click', ()=>{
        renderFavorites();
        pushView('favorites');
      });

      function renderMenu(){
        app.innerHTML = `
          <section class="result-panel">
            <button class="corner-btn back-btn" id="backBtn">←</button>
            <button class="corner-btn close-btn" id="closeBtn">×</button>
            <div class="menu">
              <div class="menu-item" data-type="restaurant">식당</div>
              <div class="menu-item" data-type="cafe">카페</div>
              <div class="menu-item" data-type="content">콘텐츠</div>
            </div>
          </section>
        `;

        // 메뉴에서 뒤로가기 → 검색창으로 복귀
        document.getElementById('backBtn').addEventListener('click', ()=>{ goHome(); });

        document.querySelectorAll('.menu-item').forEach(el => {
          el.addEventListener('click', ()=>{
            state.category = el.dataset.type;
            renderSubmenu(state.category);
            pushView('submenu', {category: state.category});
          });
        });
      }

      function renderSubmenu(category){
        let items = [];
        if(category === 'restaurant'){
          items = ['한식','일식','중식','양식','베트남식','태국식'];
        } else if(category === 'cafe'){
          items = ['브런치','디저트','전망 좋은 곳','조용한 곳','스페셜티','테라스'];
        } else if(category === 'content'){
          items = ['영화관','전시회','공연','테마파크','액티비티','포토스팟'];
        }

        app.innerHTML = `
          <section class="result-panel">
            <button class="corner-btn back-btn" id="backBtn">←</button>
            <button class="corner-btn close-btn" id="closeBtn">×</button>
            <div class="submenu">
              ${items.map(i => `<div class="submenu-item" data-sub="${i}">${i}</div>`).join('')}
            </div>
          </section>
        `;

        document.getElementById('backBtn').addEventListener('click', ()=>{ renderMenu(); pushView('menu'); });
        document.querySelectorAll('.submenu-item').forEach(el => {
          el.addEventListener('click', ()=>{
            state.type = el.dataset.sub;
            const results = getMockResults(state.location, state.category, state.type);
            renderList(results, `${state.location} · ${state.type}`);
            pushView('list', {category: state.category, type: state.type, location: state.location});
          });
        });
      }

      function renderList(items, title){
        app.innerHTML = `
          <section class="result-panel">
            <button class="corner-btn back-btn" id="backBtn">←</button>
            <button class="corner-btn close-btn" id="closeBtn">×</button>
            <div class="result-body">
              <div class="list-panel">
                <div class="list-title">${escapeHtml(title)}</div>
                ${items.map(name => `<div class="list-item" data-place="${name}">${name}</div>`).join('')}
              </div>
              <div class="detail-panel" id="detailPanel">
                <p>가게를 선택하면 상세 정보가 표시됩니다.</p>
              </div>
            </div>
          </section>
        `;

        document.getElementById('backBtn').addEventListener('click', ()=>{ renderSubmenu(state.category); pushView('submenu', {category: state.category}); });
        document.querySelectorAll('.list-item').forEach(el => {
          el.addEventListener('click', ()=>{
            const place = el.dataset.place;
            const info = getMockDetail(place);
            renderDetail(info);
          });
        });
      }

      function renderDetail(info){
        const panel = document.getElementById('detailPanel');
        const isFav = state.favorites.includes(info.name);
        panel.innerHTML = `
          <h2>${escapeHtml(info.name)}</h2>
          <img src="${info.image}" alt="${escapeHtml(info.name)}">
          <p>${escapeHtml(info.desc)}</p>
          <p>평점: ${info.rating} ⭐</p>
          <p>가격대: ${info.price}</p>
          <div class="tags">${info.tags.map(t => `<span class="tag">${escapeHtml(t)}</span>`).join('')}</div>
          <p><a href="${info.site}" target="_blank">공식 사이트</a></p>
          <p><a href="${info.map}" target="_blank">네이버 지도</a></p>
          <p>☎ ${escapeHtml(info.tel)}</p>
          <p>영업시간: ${escapeHtml(info.hours)}</p>
          <div class="favorite-btn ${isFav ? 'active' : ''}" id="favBtn">★</div>
        `;

        document.getElementById('favBtn').addEventListener('click', ()=>{
          if(isFav){
            state.favorites = state.favorites.filter(f => f !== info.name);
          } else {
            state.favorites.push(info.name);
          }
          saveFavorites();
          renderDetail(info);
        });
      }

      // 즐겨찾기 목록 + 맵
      function renderFavorites(){
        const items = state.favorites;
        app.innerHTML = `
          <section class="result-panel">
            <button class="corner-btn back-btn" id="backBtn">←</button>
            <button class="corner-btn close-btn" id="closeBtn">×</button>
            <div class="result-body">
              <div class="list-panel">
                <div class="list-title">즐겨찾기</div>
                ${items.length ? items.map(name => `<div class=\"list-item\" data-place=\"${name}\">${name}</div>`).join('') : '<p style="text-align:center; color:#555;">즐겨찾기가 비어 있습니다.</p>'}
              </div>
              <div class="detail-panel">
                <div class="fav-map" id="favMap"></div>
                <div class="fav-detail" id="favDetail">${items.length ? '마커를 클릭하거나 목록에서 선택하세요.' : ''}</div>
              </div>
            </div>
          </section>
        `;

        document.getElementById('backBtn').addEventListener('click', ()=>{ history.back(); });

        // 목록 클릭 → 상세 표시
        document.querySelectorAll('.list-item').forEach(el => {
          el.addEventListener('click', ()=>{
            const info = getMockDetail(el.dataset.place);
            renderFavDetail(info);
          });
        });

        // 맵에 모든 즐겨찾기 표시
        renderFavoritesMap(items);
      }

      function renderFavDetail(info){
        const box = document.getElementById('favDetail');
        const isFav = state.favorites.includes(info.name);
        box.innerHTML = `
          <h2>${escapeHtml(info.name)}</h2>
          <img src="${info.image}" alt="${escapeHtml(info.name)}">
          <p>${escapeHtml(info.desc)}</p>
          <p>평점: ${info.rating} ⭐ | 가격대: ${info.price}</p>
          <div class="tags">${info.tags.map(t => `<span class="tag">${escapeHtml(t)}</span>`).join('')}</div>
          <p><a href="${info.site}" target="_blank">공식 사이트</a> · <a href="${info.map}" target="_blank">네이버 지도</a></p>
          <div class="favorite-btn ${isFav ? 'active' : ''}" id="favBtn2">★</div>
        `;
        document.getElementById('favBtn2').addEventListener('click', ()=>{
          if(isFav){
            state.favorites = state.favorites.filter(f => f !== info.name);
          } else {
            state.favorites.push(info.name);
          }
          saveFavorites();
          renderFavDetail(info);
          renderFavoritesMap(state.favorites); // 맵도 즉시 갱신
        });
      }

      // 간단 Mock 맵: 이름을 좌표로 해시해 일정한 위치에 마커 표시
      function renderFavoritesMap(names){
        const map = document.getElementById('favMap');
        if(!map) return;
        map.innerHTML = '';
        names.forEach(name => {
          const pt = pointForName(name);
          const mk = document.createElement('div');
          mk.className = 'marker';
          mk.style.left = pt.x + '%';
          mk.style.top = pt.y + '%';
          mk.setAttribute('data-label', name);
          mk.addEventListener('click', ()=>{
            const info = getMockDetail(name);
            renderFavDetail(info);
          });
          map.appendChild(mk);
        });
      }

      function pointForName(name){
        // 해시 기반 10%~90% 범위 내 퍼센트 좌표 생성(목업)
        let h = 0;
        for (let i = 0; i < name.length; i++) h = (h * 31 + name.charCodeAt(i)) >>> 0;
        const x = 10 + (h % 8000) / 100;      // 10% ~ 90%
        const y = 10 + ((h >>> 8) % 8000) / 100; // 10% ~ 90%
        return { x: Math.min(90, x), y: Math.min(90, y) };
      }

      // Mock 리스트
      function getMockResults(location, category, type){
        if(category === 'restaurant' && type === '한식'){
          if((location || '').includes('강남')){
            return ['새벽집', '삼원가든', '봉산집'];
          }
          return ['김밥천국', '한촌설렁탕'];
        }
        return ['샘플 A','샘플 B','샘플 C'];
      }

      // Mock 상세 정보
      function getMockDetail(name){
        if(name === '새벽집'){
          return {
            name: '새벽집',
            image: 'https://source.unsplash.com/400x250/?korean-food',
            desc: '강남구 역삼동에 위치한 24시간 한우 전문점',
            rating: '4.5/5',
            price: '2만원 ~ 4만원',
            tags: ['가족 모임','회식','데이트'],
            site: 'https://naver.com',
            map: 'https://map.naver.com',
            tel: '02-123-4567',
            hours: '매일 00:00 ~ 24:00'
          };
        }
        if(name === '삼원가든'){
          return {
            name: '삼원가든',
            image: 'https://source.unsplash.com/400x250/?korean-bbq',
            desc: '고급 한우와 넓은 좌석을 갖춘 유명 한정식·구이 전문점',
            rating: '4.6/5',
            price: '3만원 ~ 6만원',
            tags: ['가족 모임','상견례','주차 가능'],
            site: 'https://naver.com',
            map: 'https://map.naver.com',
            tel: '02-234-5678',
            hours: '매일 11:00 ~ 22:00'
          };
        }
        if(name === '봉산집'){
          return {
            name: '봉산집',
            image: 'https://source.unsplash.com/400x250/?korean-restaurant',
            desc: '갈비와 냉면으로 유명한 한식 맛집',
            rating: '4.4/5',
            price: '2만원 ~ 4만원',
            tags: ['회식','가족 모임'],
            site: 'https://naver.com',
            map: 'https://map.naver.com',
            tel: '02-345-6789',
            hours: '매일 11:30 ~ 22:00'
          };
        }
        return {
          name,
          image: 'https://source.unsplash.com/400x250/?restaurant',
          desc: '샘플 설명입니다.',
          rating: '정보 없음',
          price: '정보 없음',
          tags: ['일반'],
          site: '#',
          map: '#',
          tel: '정보 없음',
          hours: '정보 없음'
        };
      }

      // 즐겨찾기 저장/로드 (localStorage 버전)
      function saveFavorites(){
        try { localStorage.setItem('favorites', JSON.stringify(state.favorites)); } catch(e){}
      }
      function loadFavorites(){
        try { return JSON.parse(localStorage.getItem('favorites')||'[]'); } catch(e){ return []; }
      }

      function goHome(){
        app.innerHTML = '';
        app.appendChild(form);
        form.reset();
        input.focus();
        history.pushState({view:'search'}, '', '#search');
      }

      // 검색 제출 → 메뉴 진입 (기존 동작 그대로)
      form.addEventListener('submit', (e)=>{
        e.preventDefault();
        const term = input.value.trim();
        if(!term) return;
        state.location = term;
        renderMenu();
        pushView('menu');
      });

      // 브라우저 뒤로가기 대응
      window.addEventListener('popstate', (e)=>{
        const v = (e.state && e.state.view) || 'search';
        if(v === 'search') return goHome();
        if(v === 'menu') return renderMenu();
        if(v === 'submenu') return renderSubmenu(state.category);
        if(v === 'list') return renderList(getMockResults(state.location, state.category, state.type), `${state.location} · ${state.type}`);
        if(v === 'favorites') return renderFavorites();
      });

      // 유틸: XSS 방지
      function escapeHtml(str){
        return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[s]));
      }
    </script>
  </body>
</html>
